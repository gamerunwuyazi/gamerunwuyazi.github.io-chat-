"use strict";(self["webpackChunkvue_chat"]=self["webpackChunkvue_chat"]||[]).push([[192],{192:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});t(9112),t(3110);var r=t(6768),s=t(144),l=t(302);const n={class:"login-container"},o={class:"login-form"},c={class:"input-group"},u={class:"input-group"},i={class:"input-group"},d={style:{display:"flex",gap:"10px","align-items":"center"}},p={class:"register-link"};var v={__name:"Login",setup(e){const a=(0,s.KR)(null),t=(0,s.KR)(null),v=(0,s.KR)(null),k=(0,s.KR)(null),f=(0,s.KR)(null),h=(0,s.KR)(null);let m="";async function g(){try{const e=await fetch("https://back.hs.airoe.cn/captcha"),a=await e.json();"success"===a.status&&h.value&&(h.value.innerHTML=a.captchaSvg,m=a.captchaId)}catch(e){L("获取验证码失败，请稍后重试","error")}}async function y(e){e.preventDefault();const a=t.value?.value?.trim()||"",r=v.value?.value?.trim()||"",s=f.value?.value?.trim()||"";if(a&&r&&s)try{const e=await fetch("https://back.hs.airoe.cn/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:r,captchaId:m,captchaCode:s})}),t=await e.text();let o;try{o=JSON.parse(t)}catch(n){return void L("服务器响应格式错误，请稍后重试","error")}if(console.log("登录响应数据:",o),o.success||"success"===o.status||200===o.code){const e=o.userId||o.user&&o.user.id||o.data&&o.data.id||"",a=o.nickname||o.user&&o.user.nickname||o.data&&o.data.nickname||"",t=o.avatarUrl||o.user&&o.user.avatarUrl||o.data&&o.data.avatarUrl||o.user&&o.user.avatar||o.data&&o.data.avatar||null,r=o.sessionToken||o.token||o.session_token;if(!e||!r)return L("登录响应数据不完整，请稍后重试","error"),void g();const s={id:e?String(e):"",nickname:a,avatarUrl:t&&"string"===typeof t?t.trim():null};localStorage.setItem("currentUser",JSON.stringify(s)),localStorage.setItem("currentSessionToken",r),localStorage.setItem("chatUserId",s.id),localStorage.setItem("chatUserNickname",s.nickname),localStorage.setItem("chatSessionToken",r),s.avatarUrl&&"string"===typeof s.avatarUrl?localStorage.setItem("chatUserAvatar",s.avatarUrl.trim()):localStorage.removeItem("chatUserAvatar"),(0,l.iD)()}else{const e=o.message||o.msg||"登录失败，请检查用户名和密码";L(e,"error"),g()}}catch(o){L("登录请求失败，请检查用户名/密码是否合法，并稍后重试","error"),g()}else L("请输入用户名、密码和验证码","error")}function L(e,a){k.value&&(k.value.textContent=e,k.value.style.display="block","error"===a?(k.value.style.color="#d32f2f",k.value.style.backgroundColor="#ffebee",k.value.style.borderColor="#ffcdd2"):"success"===a&&(k.value.style.color="#388e3c",k.value.style.backgroundColor="#e8f5e8",k.value.style.borderColor="#c8e6c9"))}return(0,r.sV)(()=>{g(),h.value&&h.value.addEventListener("click",g),a.value&&a.value.addEventListener("submit",y)}),(e,s)=>{const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",n,[s[7]||(s[7]=(0,r.Lk)("div",{class:"decoration decoration-1"},null,-1)),s[8]||(s[8]=(0,r.Lk)("div",{class:"decoration decoration-2"},null,-1)),s[9]||(s[9]=(0,r.Lk)("div",{class:"decoration decoration-3"},null,-1)),(0,r.Lk)("div",o,[s[6]||(s[6]=(0,r.Lk)("h1",null,"登录聊天室",-1)),(0,r.Lk)("form",{ref_key:"loginForm",ref:a},[(0,r.Lk)("div",c,[s[0]||(s[0]=(0,r.Lk)("label",{for:"username"},"用户名",-1)),(0,r.Lk)("input",{type:"text",id:"username",ref_key:"usernameInput",ref:t,name:"username",required:"",placeholder:"请输入用户名"},null,512)]),(0,r.Lk)("div",u,[s[1]||(s[1]=(0,r.Lk)("label",{for:"password"},"密码",-1)),(0,r.Lk)("input",{type:"password",id:"password",ref_key:"passwordInput",ref:v,name:"password",required:"",placeholder:"请输入密码"},null,512)]),(0,r.Lk)("div",i,[s[2]||(s[2]=(0,r.Lk)("label",{for:"captcha"},"验证码",-1)),(0,r.Lk)("div",d,[(0,r.Lk)("input",{type:"text",id:"captcha",ref_key:"captchaInput",ref:f,name:"captcha",required:"",placeholder:"请输入验证码",style:{flex:"1",width:"0"}},null,512),(0,r.Lk)("div",{ref_key:"captchaContainer",ref:h,style:{cursor:"pointer","flex-shrink":"0",width:"120px"}},null,512)])]),s[3]||(s[3]=(0,r.Lk)("button",{type:"submit"},"登录",-1))],512),(0,r.Lk)("p",p,[s[5]||(s[5]=(0,r.eW)("还没有账号？",-1)),(0,r.bF)(l,{to:"/register"},{default:(0,r.k6)(()=>[...s[4]||(s[4]=[(0,r.eW)("去注册",-1)])]),_:1})]),(0,r.Lk)("div",{ref_key:"loginMessage",ref:k,class:"login-message",style:{display:"none"}},null,512)])])}}},k=t(1241);const f=(0,k.A)(v,[["__scopeId","data-v-aa3b7ba8"]]);var h=f},1241:function(e,a){a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[r,s]of a)t[r]=s;return t}}}]);