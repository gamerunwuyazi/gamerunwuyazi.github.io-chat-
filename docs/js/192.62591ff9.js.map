{"version":3,"file":"js/192.62591ff9.js","mappings":"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","sources":["webpack://vue-chat/./src/views/Login.vue","webpack://vue-chat/./src/views/Login.vue?240b"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <div class=\"login-container\">\n    <!-- 装饰性元素 -->\n    <div class=\"decoration decoration-1\"></div>\n    <div class=\"decoration decoration-2\"></div>\n    <div class=\"decoration decoration-3\"></div>\n    \n    <div class=\"login-form\">\n      <h1>登录聊天室</h1>\n      <form ref=\"loginForm\">\n        <div class=\"input-group\">\n          <label for=\"username\">用户名</label>\n          <input type=\"text\" id=\"username\" ref=\"usernameInput\" name=\"username\" required placeholder=\"请输入用户名\">\n        </div>\n        <div class=\"input-group\">\n          <label for=\"password\">密码</label>\n          <input type=\"password\" id=\"password\" ref=\"passwordInput\" name=\"password\" required placeholder=\"请输入密码\">\n        </div>\n        <div class=\"input-group\">\n          <label for=\"captcha\">验证码</label>\n          <div style=\"display: flex; gap: 10px; align-items: center;\">\n            <input type=\"text\" id=\"captcha\" ref=\"captchaInput\" name=\"captcha\" required placeholder=\"请输入验证码\" style=\"flex: 1; width: 0;\"> <!-- width: 0 确保flex: 1 能正常工作 -->\n            <div ref=\"captchaContainer\" style=\"cursor: pointer; flex-shrink: 0; width: 120px;\"></div>\n          </div>\n        </div>\n        <button type=\"submit\">登录</button>\n      </form>\n      <p class=\"register-link\">还没有账号？<router-link to=\"/register\">去注册</router-link></p>\n      <div ref=\"loginMessage\" class=\"login-message\" style=\"display: none;\"></div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n  import { ref, onMounted } from 'vue';\n  import {login} from \"@/utils/chat\";\n\n  \n  // 使用ref引用DOM元素\n  const loginForm = ref(null);\n  const usernameInput = ref(null);\n  const passwordInput = ref(null);\n  const loginMessage = ref(null);\n  const captchaInput = ref(null);\n  const captchaContainer = ref(null);\n  let currentCaptchaId = '';\n\n  // 获取验证码\n  async function getCaptcha() {\n    try {\n      const response = await fetch('https://back.hs.airoe.cn/captcha');\n      const data = await response.json();\n      if (data.status === 'success' && captchaContainer.value) {\n        captchaContainer.value.innerHTML = data.captchaSvg;\n        currentCaptchaId = data.captchaId;\n      }\n    } catch (error) {\n      showMessage('获取验证码失败，请稍后重试', 'error');\n    }\n  }\n\n  // 登录表单提交事件处理\n  async function handleLogin(e) {\n    e.preventDefault();\n\n    const username = usernameInput.value?.value?.trim() || '';\n    const password = passwordInput.value?.value?.trim() || '';\n    const captchaCode = captchaInput.value?.value?.trim() || '';\n\n    if (!username || !password || !captchaCode) {\n      showMessage('请输入用户名、密码和验证码', 'error');\n      return;\n    }\n\n    try {\n      // 提交登录请求\n      const response = await fetch('https://back.hs.airoe.cn/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: username,\n          password: password,\n          captchaId: currentCaptchaId,\n          captchaCode: captchaCode\n        })\n      });\n\n      const responseText = await response.text();\n\n      let data;\n      try {\n        data = JSON.parse(responseText);\n      } catch (parseError) {\n        showMessage('服务器响应格式错误，请稍后重试', 'error');\n        return;\n      }\n\n      // 改进的响应处理逻辑，支持不同的响应格式\n      console.log('登录响应数据:', data);\n      if (data.success || data.status === 'success' || data.code === 200) {\n        // 登录成功，构造正确的用户信息对象\n        const userId = data.userId || (data.user && data.user.id) || (data.data && data.data.id) || '';\n        const nickname = data.nickname || (data.user && data.user.nickname) || (data.data && data.data.nickname) || '';\n        const avatarUrl = data.avatarUrl || (data.user && data.user.avatarUrl) || (data.data && data.data.avatarUrl) || (data.user && data.user.avatar) || (data.data && data.data.avatar) || null;\n        const sessionToken = data.sessionToken || data.token || data.session_token;\n\n        // 检查必要字段是否存在\n        if (!userId || !sessionToken) {\n          showMessage('登录响应数据不完整，请稍后重试', 'error');\n          getCaptcha();\n          return;\n        }\n\n        // 构造与原UI一致的currentUser对象\n        const userData = {\n          id: userId ? String(userId) : '',\n          nickname: nickname,\n          avatarUrl: avatarUrl && typeof avatarUrl === 'string' ? avatarUrl.trim() : null\n        };\n\n        // 保存到新的localStorage键（与原UI一致）\n        localStorage.setItem('currentUser', JSON.stringify(userData));\n        localStorage.setItem('currentSessionToken', sessionToken);\n\n        // 同时保存到旧的localStorage键，确保兼容性（与原UI一致）\n        localStorage.setItem('chatUserId', userData.id);\n        localStorage.setItem('chatUserNickname', userData.nickname);\n        localStorage.setItem('chatSessionToken', sessionToken);\n\n        // 只有当头像URL有效时才设置到localStorage（与原UI一致）\n        if (userData.avatarUrl && typeof userData.avatarUrl === 'string') {\n          localStorage.setItem('chatUserAvatar', userData.avatarUrl.trim());\n        } else {\n          localStorage.removeItem('chatUserAvatar');\n        }\n\n        // 跳转到新的聊天室页面\n        login();\n      } else {\n        // 登录失败，显示错误信息\n        const errorMessage = data.message || data.msg || '登录失败，请检查用户名和密码';\n        showMessage(errorMessage, 'error');\n        // 失败时刷新验证码\n        getCaptcha();\n      }\n    } catch (error) {\n      showMessage('登录请求失败，请检查用户名/密码是否合法，并稍后重试', 'error');\n      // 失败时刷新验证码\n      getCaptcha();\n    }\n  }\n\n  // 显示消息函数\n  function showMessage(message, type) {\n    if (loginMessage.value) {\n      loginMessage.value.textContent = message;\n      loginMessage.value.style.display = 'block';\n\n      if (type === 'error') {\n        loginMessage.value.style.color = '#d32f2f';\n        loginMessage.value.style.backgroundColor = '#ffebee';\n        loginMessage.value.style.borderColor = '#ffcdd2';\n      } else if (type === 'success') {\n        loginMessage.value.style.color = '#388e3c';\n        loginMessage.value.style.backgroundColor = '#e8f5e8';\n        loginMessage.value.style.borderColor = '#c8e6c9';\n      }\n    }\n  }\n\n  // 在组件挂载后初始化\n  onMounted(() => {\n    // 加载验证码\n    getCaptcha();\n    \n    // 添加验证码点击事件\n    if (captchaContainer.value) {\n      captchaContainer.value.addEventListener('click', getCaptcha);\n    }\n    \n    // 添加表单提交事件\n    if (loginForm.value) {\n      loginForm.value.addEventListener('submit', handleLogin);\n    }\n  });\n</script>\n\n<style scoped>\n/* 登录页面容器样式 */\n.login-container {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  padding: 20px;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n/* 装饰性元素 */\n.decoration {\n  position: absolute;\n  border-radius: 50%;\n  background: rgba(255, 255, 255, 0.2);\n}\n\n.decoration-1 {\n  width: 150px;\n  height: 150px;\n  background: rgba(255, 255, 255, 0.2);\n  top: -150px;\n  right: 0px;\n  animation: float 16s infinite ease-in-out;\n}\n\n.decoration-2 {\n  width: 200px;\n  height: 200px;\n  background: rgba(255, 255, 255, 0.18);\n  bottom: -100px;\n  left: -50px;\n  animation: float 12s infinite ease-in-out;\n}\n\n.decoration-3 {\n  width: 100px;\n  height: 100px;\n  background: rgba(255, 255, 255, 0.15);\n  top: 50%;\n  right: 50px;\n  animation: float 8s infinite ease-in-out;\n}\n\n@keyframes float {\n  0%,\n  100% {\n    transform: translateY(0) translateX(0);\n  }\n\n  25% {\n    transform: translateY(-60px) translateX(30px);\n  }\n\n  50% {\n    transform: translateY(30px) translateX(-45px);\n  }\n\n  75% {\n    transform: translateY(-30px) translateX(-30px);\n  }\n}\n\n/* 登录表单容器 */\n.login-form {\n  position: relative;\n  background: white;\n  padding: 40px;\n  border-radius: 12px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n  width: 100%;\n  max-width: 400px;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n  z-index: 10;\n}\n\n.login-form:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);\n}\n\n/* 标题样式 */\nh1 {\n  text-align: center;\n  color: #333;\n  margin-bottom: 30px;\n  font-size: 24px;\n  font-weight: 600;\n}\n\n/* 表单样式 */\nform {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n/* 输入组样式 */\n.input-group {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n/* 标签样式 */\nlabel {\n  font-size: 14px;\n  font-weight: 500;\n  color: #555;\n}\n\n/* 输入框样式 */\ninput {\n  padding: 12px 15px;\n  border: 2px solid #e1e5e9;\n  border-radius: 8px;\n  font-size: 16px;\n  transition: all 0.3s ease;\n  background-color: #f9fafb;\n}\n\ninput:focus {\n  outline: none;\n  border-color: #667eea;\n  background-color: white;\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n}\n\n/* 按钮样式 */\nbutton {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border: none;\n  padding: 14px;\n  border-radius: 8px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin-top: 10px;\n}\n\nbutton:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);\n}\n\nbutton:active {\n  transform: translateY(0);\n}\n\n/* 注册链接样式 */\n.register-link {\n  text-align: center;\n  margin-top: 25px;\n  font-size: 14px;\n  color: #666;\n}\n\n.register-link a {\n  color: #667eea;\n  text-decoration: none;\n  font-weight: 500;\n  transition: color 0.3s ease;\n}\n\n.register-link a:hover {\n  color: #764ba2;\n  text-decoration: underline;\n}\n\n/* 消息提示样式 */\n.login-message {\n  color: #d32f2f;\n  text-align: center;\n  font-size: 14px;\n  margin-top: 15px;\n  padding: 10px;\n  background-color: #ffebee;\n  border-radius: 6px;\n  border: 1px solid #ffcdd2;\n}\n\n/* 响应式设计 */\n@media (max-width: 480px) {\n  .login-form {\n    padding: 30px 20px;\n  }\n\n  h1 {\n    font-size: 22px;\n  }\n\n  input, button {\n    font-size: 15px;\n  }\n}\n</style>","import script from \"./Login.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Login.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Login.vue?vue&type=style&index=0&id=aa3b7ba8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-aa3b7ba8\"]])\n\nexport default __exports__"],"names":["loginForm","ref","usernameInput","passwordInput","loginMessage","captchaInput","captchaContainer","currentCaptchaId","async","getCaptcha","response","fetch","data","json","status","value","innerHTML","captchaSvg","captchaId","error","showMessage","handleLogin","e","preventDefault","username","trim","password","captchaCode","method","headers","body","JSON","stringify","responseText","text","parse","parseError","console","log","success","code","userId","user","id","nickname","avatarUrl","avatar","sessionToken","token","session_token","userData","String","localStorage","setItem","removeItem","login","errorMessage","message","msg","type","textContent","style","display","color","backgroundColor","borderColor","onMounted","addEventListener","_createElementBlock","_hoisted_1","_createElementVNode","class","_hoisted_2","_hoisted_3","for","name","required","placeholder","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_createVNode","_component_router_link","to","_cache","__exports__"],"ignoreList":[],"sourceRoot":""}